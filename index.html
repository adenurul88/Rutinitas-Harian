<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rutinitas Harian</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4f46e5">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f3f4f6;
}
header {
  background: #4f46e5;
  color: white;
  padding: 16px;
  text-align: center;
}
.section {
  background: white;
  margin: 12px;
  padding: 12px;
  border-radius: 10px;
}
.routine {
  margin-bottom: 10px;
}
.routine h3 {
  margin: 0;
}
img {
  max-width: 100%;
  border-radius: 8px;
  margin-top: 6px;
}
button {
  margin-top: 6px;
}
.history-item {
  border-bottom: 1px solid #ddd;
  padding: 6px 0;
}
</style>
</head>

<body>

<header>
  <h1>Rutinitas Harian</h1>
  <p id="today"></p>
</header>

<div id="routines"></div>

<div class="section">
  <button onclick="showHistory()">Lihat Riwayat</button>
  <div id="history"></div>
</div>

<script>
const routines = [
  {name:"Mandi Pagi", time:"04:30"},
  {name:"Shalat Subuh", time:"04:55"},
  {name:"Dzikir Pagi", time:"05:05"},
  {name:"Sapu & Pel Rumah", time:"05:15"},
  {name:"Olahraga", time:"06:30"},
  {name:"Duolingo", time:"07:30"},
  {name:"Baca Buku", time:"09:00"},
  {name:"Pembersihan Rumah", time:"10:00"}
];

const today = new Date().toISOString().slice(0,10);
document.getElementById("today").innerText = "Tanggal: " + today;

function load() {
  const data = JSON.parse(localStorage.getItem("data") || "{}");
  const container = document.getElementById("routines");
  container.innerHTML = "";

  routines.forEach((r,i)=>{
    const div = document.createElement("div");
    div.className="section routine";
    const key = today+"-"+i;
    const entry = data[key];

    div.innerHTML = `
      <h3>${r.time} - ${r.name}</h3>
      <input type="file" accept="image/*" onchange="saveImage(event,'${key}')">
      ${entry ? `
        <p>Upload: ${entry.time}</p>
        <img src="${entry.img}">
        <br>
        <button onclick="remove('${key}')">Hapus</button>
      ` : ""}
    `;
    container.appendChild(div);
  });
}

function saveImage(e,key){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = ()=>{
    const data = JSON.parse(localStorage.getItem("data") || "{}");
    data[key] = {
      img: reader.result,
      time: new Date().toLocaleTimeString()
    };
    localStorage.setItem("data",JSON.stringify(data));
    load();
  };
  reader.readAsDataURL(file);
}

function remove(key){
  const data = JSON.parse(localStorage.getItem("data"));
  delete data[key];
  localStorage.setItem("data",JSON.stringify(data));
  load();
}

function showHistory(){
  const data = JSON.parse(localStorage.getItem("data") || "{}");
  const h = document.getElementById("history");
  h.innerHTML="<h3>Riwayat</h3>";

  Object.keys(data).forEach(k=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.innerText = k+" | "+data[k].time;
    h.appendChild(div);
  });
}

load();

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>