<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rutinitas Harian</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ===== WARNA SOFT ===== */
:root{
  --pink:#f7c6d9;
  --tosca:#9ad9d1;
  --pink-dark:#e9a9c1;
  --text:#444;
}

/* ===== GLOBAL ===== */
body {
  margin: 0;
  background: #fff6f9;
  color: var(--text);
  font-family: "Geraldine Jinn", "Times New Roman", serif;
}

/* ===== HEADER ===== */
header {
  background: linear-gradient(135deg, var(--pink), var(--tosca));
  padding: 18px;
  text-align: center;
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
}
header h1 {
  margin: 0;
  font-family: "Amanda", "Comic Sans MS", cursive;
  font-size: 28px;
}
header p {
  margin: 4px 0 0;
  font-size: 14px;
}

/* ===== CARD ===== */
.section {
  background: white;
  margin: 14px;
  padding: 14px;
  border-radius: 14px;
  box-shadow: 0 4px 8px rgba(0,0,0,.05);
}

/* ===== CHECKLIST ===== */
.check {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 8px 0;
}
.status-done {
  color: #2e8b57;
  font-weight: bold;
}
.status-not {
  color: #777;
}

/* ===== FOTO ===== */
.photo {
  width: 75px;
  height: 75px;
  object-fit: cover;
  border-radius: 8px;
  border: 2px solid var(--pink);
  margin-top: 6px;
}

/* ===== BUTTON ===== */
button {
  background: var(--tosca);
  border: none;
  padding: 8px 14px;
  border-radius: 20px;
  font-family: "Geraldine Jinn", serif;
  font-size: 14px;
  cursor: pointer;
}
button:hover {
  background: var(--pink-dark);
}
input[type="file"]{
  margin-top:6px;
}
</style>
</head>

<body>

<header>
  <h1>Rutinitas Harian</h1>
  <p id="today"></p>
</header>

<div id="routines"></div>

<div class="section">
  <button onclick="showHistory()">Riwayat Harian</button>
  <button onclick="exportPDF()">Export PDF</button>
  <div id="history"></div>
</div>

<script>
const routines = [
  {name:"Mandi Pagi", time:"04:30"},
  {name:"Shalat Subuh", time:"04:55"},
  {name:"Dzikir Pagi", time:"05:05"},
  {name:"Sapu & Pel Rumah", time:"05:15"},
  {name:"Olahraga 15 Menit", time:"06:30"},
  {name:"Duolingo Matematika", time:"07:30"},
  {name:"Duolingo Bahasa Inggris", time:"08:00"},
  {name:"Shalat Dzuhur", time:"12:15"},
  {name:"Kajian", time:"12:45"},
  {name:"Baca Buku Target", time:"14:00"},
  {name:"Shalat Ashar", time:"15:35"},
  {name:"Dzikir Petang", time:"15:45"},
  {name:"Mandi Sore", time:"17:00"},
  {name:"Shalat Maghrib", time:"18:10"},
  {name:"Shalat Isya", time:"19:25"},
  {name:"Tidur", time:"22:00"}
];

const today = new Date().toISOString().slice(0,10);
document.getElementById("today").innerText = "Tanggal: " + today;

function load(){
  const data = JSON.parse(localStorage.getItem("data") || "{}");
  const c = document.getElementById("routines");
  c.innerHTML="";

  routines.forEach((r,i)=>{
    const key=today+"-"+i;
    const e=data[key]||{};
    const div=document.createElement("div");
    div.className="section";

    div.innerHTML=`
      <h3>${r.time} - ${r.name}</h3>

      <div class="check">
        <input type="checkbox" ${e.done?"checked":""}
          onchange="toggleDone('${key}',this.checked)">
        <span class="${e.done?"status-done":"status-not"}">
          ${e.done?"Sudah Dilakukan ("+e.doneTime+")":"Belum Dilakukan"}
        </span>
      </div>

      <input type="file" accept="image/*" onchange="saveImage(event,'${key}')">

      ${e.img?`
        <img src="${e.img}" class="photo"><br>
        <button onclick="remove('${key}')">Hapus</button>
      `:""}
    `;
    c.appendChild(div);
  });
}

function toggleDone(k,v){
  const d=JSON.parse(localStorage.getItem("data")||"{}");
  if(!d[k])d[k]={};
  d[k].done=v;
  d[k].doneTime=v?new Date().toLocaleTimeString():"";
  localStorage.setItem("data",JSON.stringify(d));
  load();
}

function saveImage(e,k){
  const r=new FileReader();
  r.onload=()=>{
    const d=JSON.parse(localStorage.getItem("data")||"{}");
    if(!d[k])d[k]={};
    d[k].img=r.result;
    localStorage.setItem("data",JSON.stringify(d));
    load();
  };
  r.readAsDataURL(e.target.files[0]);
}

function remove(k){
  const d=JSON.parse(localStorage.getItem("data")||"{}");
  delete d[k];
  localStorage.setItem("data",JSON.stringify(d));
  load();
}

function showHistory(){
  const d=JSON.parse(localStorage.getItem("data")||"{}");
  const h=document.getElementById("history");
  h.innerHTML="<h3>Riwayat Harian</h3>";
  Object.keys(d).forEach(k=>{
    const p=document.createElement("p");
    p.innerText=k+" | "+(d[k].done?"✔":"✘");
    h.appendChild(p);
  });
}

function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=10;
  pdf.text("Rekap Rutinitas - "+today,10,y);
  y+=10;
  routines.forEach((r,i)=>{
    const e=JSON.parse(localStorage.getItem("data")||"{}")[today+"-"+i];
    pdf.text(`${r.time} - ${r.name} : ${e?.done?"Sudah":"Belum"}`,10,y);
    y+=8;
  });
  pdf.save("rutinitas-"+today+".pdf");
}

load();
</script>

</body>
</html>