<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rutinitas Harian</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --pink:#f7c6d9;
  --tosca:#9ad9d1;
  --pink-dark:#e9a9c1;
  --text:#444;
}

body{
  margin:0;
  background:#fff6f9;
  font-family:"Geraldine Jinn","Times New Roman",serif;
  color:var(--text);
}

/* HEADER */
header{
  background:linear-gradient(135deg,var(--pink),var(--tosca));
  padding:18px;
  text-align:center;
  border-radius:0 0 20px 20px;
}

/* CARD */
.section{
  background:#fff;
  margin:14px;
  padding:14px;
  border-radius:14px;
  box-shadow:0 4px 8px rgba(0,0,0,.05);
}

button{
  background:var(--tosca);
  border:none;
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
  margin:4px 2px;
}
button:hover{background:var(--pink-dark);}

.check{display:flex;gap:8px;margin:6px 0;}
.status-done{color:#2e8b57;font-weight:bold;}
.status-not{color:#777;}

.soft-note{font-size:12px;opacity:.6}

.photo{
  width:70px;height:70px;
  border-radius:8px;
  object-fit:cover;
  border:2px solid var(--pink);
  margin-top:6px;
}

/* CONFETTI */
.confetti{position:fixed;inset:0;pointer-events:none;z-index:9999;}
.confetti span{
  position:absolute;width:8px;height:14px;border-radius:3px;
  animation:fall 1s linear forwards;
}
@keyframes fall{
  to{transform:translateY(100vh) rotate(360deg);opacity:0;}
}
</style>
</head>

<body>

<header>
  <h2>Rutinitas Harian</h2>
  <input type="date" id="calendar" style="padding:6px;border-radius:8px;border:none">
</header>

<div class="section">
  <button onclick="addActivity()">‚ûï Tambah Kegiatan</button>
  <button onclick="toggleEdit()">‚úèÔ∏è Edit</button>
  <button onclick="saveAll()">üíæ Simpan</button>
</div>

<div id="routines"></div>

<div class="section">
  <button onclick="exportPDF()">Export PDF</button>
</div>

<script>
let editMode=false;
let selectedDate=new Date().toISOString().slice(0,10);
document.getElementById("calendar").value=selectedDate;

const routines=[  
  {n:"Mandi Pagi",t:"04:30"},  
  {n:"Shalat Fajar",t:"04:50"},  
  {n:"Shalat Subuh",t:"04:55"},  
  {n:"Dzikir Pagi",t:"05:05"},  
  {n:"Sapu & Pel Rumah Pagi",t:"05:15"},  
  {n:"Olahraga",t:"06:30"},  
  {n:"Duolingo Matematika",t:"07:30"},  
  {n:"Duolingo Bahasa Inggris",t:"08:00"},  
  {n:"Pembersihan Cicilan",t:"09.00"},  
  {n:"Shalat Dzuhur",t:"12:15"},  
  {n:"Kajian",t:"12:45"},  
  {n:"Baca Buku Target",t:"14:00"},  
  {n:"Shalat Ashar",t:"15:35"},  
  {n:"Dzikir Petang",t:"15:45"},  
  {n:"Mandi Sore",t:"17:00"},  
  {n:"Sapu & Pel Rumah Sore",t:"17.30"},  
  {n:"Shalat Maghrib",t:"18:10"},  
  {n:"Shalat Isya",t:"19:25"},  
  {n:"Setoran Al-Qur'an",t:"21.00"},  
  {n:"Tidur",t:"22:00"}  
];  

function getData(){
  return JSON.parse(localStorage.getItem("planner")||"{}");
}
function saveData(d){
  localStorage.setItem("planner",JSON.stringify(d));
}

document.getElementById("calendar").onchange=e=>{
  selectedDate=e.target.value;
  load();
};

function load(){
  const data=getData();
  if(!data[selectedDate]){
    data[selectedDate]=JSON.parse(JSON.stringify(defaultRoutines));
    saveData(data);
  }
  const c=document.getElementById("routines");
  c.innerHTML="";

  data[selectedDate].forEach((r,i)=>{
    const d=document.createElement("div");
    d.className="section";

    d.innerHTML=`
      <input ${editMode?"":"disabled"} value="${r.t}" style="width:70px">
      <input ${editMode?"":"disabled"} value="${r.n}" style="width:65%">

      ${r.n==="Olahraga"?`<div class="soft-note">15 menit</div>`:""}

      <div class="check">
        <input type="checkbox" ${r.done?"checked":""}
        onchange="toggleDone(${i},this.checked)">
        <span class="${r.done?"status-done":"status-not"}">
        ${r.done?"Sudah":"Belum"}
        </span>
      </div>

      ${r.n.includes("Baca Buku")?`
        <input placeholder="Judul buku" value="${r.note||""}"
        oninput="saveNote(${i},this.value)"
        style="width:100%;padding:6px">
      `:""}

      <input type="file" onchange="saveImg(event,${i})">
      ${r.img?`<img src="${r.img}" class="photo">`:""}
    `;
    c.appendChild(d);
  });
}

function toggleDone(i,v){
  const d=getData();
  d[selectedDate][i].done=v;
  saveData(d);
  if(v)confetti();
}

function saveNote(i,v){
  const d=getData();
  d[selectedDate][i].note=v;
  saveData(d);
}

function saveImg(e,i){
  const r=new FileReader();
  r.onload=()=>{
    const d=getData();
    d[selectedDate][i].img=r.result;
    saveData(d);
    load();
  };
  r.readAsDataURL(e.target.files[0]);
}

function addActivity(){
  const d=getData();
  d[selectedDate].push({t:"00:00",n:"Kegiatan Baru"});
  saveData(d);
  load();
}

function toggleEdit(){
  editMode=!editMode;
  load();
}

function saveAll(){
  alert("Data tersimpan ‚úî");
}

function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=10;
  pdf.text("Rutinitas "+selectedDate,10,y);
  y+=10;
  getData()[selectedDate].forEach(r=>{
    pdf.text(`${r.t} - ${r.n}`,10,y);
    y+=8;
  });
  pdf.save("rutinitas-"+selectedDate+".pdf");
}

function confetti(){
  const c=document.createElement("div");
  c.className="confetti";
  for(let i=0;i<30;i++){
    const s=document.createElement("span");
    s.style.left=Math.random()*100+"%";
    s.style.background=i%2?"var(--pink)":"var(--tosca)";
    c.appendChild(s);
  }
  document.body.appendChild(c);
  setTimeout(()=>c.remove(),1200);
}

load();
</script>

</body>
</html>